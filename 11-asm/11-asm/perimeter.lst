     1                                  extern SPHERE
     2                                  extern PARALLELEPIPED
     3                                  extern TETRAHEDRON
     4                                  
     5                                  
     6                                  global SquareSPHERE
     7                                  SquareSPHERE:
     8                                  section .data
     9 00000000 1F85EB51B81E0940            PI dq 3.14 ;11,00100011b ; 3,14
    10                                  section .text
    11 00000000 55                      push rbp
    12 00000001 4889E5                  mov rbp, rsp
    13                                  
    14                                      ; В rdi адрес прямоугольника
    15 00000004 8B07                        mov eax, [rdi]
    16 00000006 F20F2AC0                    cvtsi2sd    xmm0, eax
    17 0000000A F20F100C25-                 movsd xmm1, [PI]
    17 0000000F [00000000]         
    18 00000013 F20F59C0                    mulsd xmm0, xmm0
    19 00000017 F20F59C1                    mulsd xmm0, xmm1
    20 0000001B F20F58C0                    addsd xmm0, xmm0
    21                                  
    22 0000001F C9                      leave
    23 00000020 C3                      ret
    24                                  
    25                                  
    26                                  global SquarePARALLELEPIPED
    27                                  SquarePARALLELEPIPED:
    28                                  section .text
    29 00000021 55                      push rbp
    30 00000022 4889E5                  mov rbp, rsp
    31                                  
    32                                      ; В rdi адрес треугольника
    33 00000025 8B1F                        mov ebx, [rdi]      ;x
    34 00000027 8B4F04                      mov ecx, [rdi+4]    ;y  
    35 0000002A 8B7708                      mov esi, [rdi+8]    ;z
    36 0000002D 89DF                        mov edi, ebx
    37 0000002F 0FAFF9                      imul edi, ecx       ;x*y
    38 00000032 89F8                        mov eax, edi
    39 00000034 89DF                        mov edi, ebx
    40 00000036 0FAFFE                      imul edi, esi       ;x*z
    41 00000039 01F8                        add eax, edi
    42 0000003B 89CF                        mov edi, ecx
    43 0000003D 0FAFFE                      imul edi, esi       ;y*z
    44 00000040 01F8                        add eax, edi
    45 00000042 01C0                        add eax, eax
    46                                  
    47 00000044 F20F2AC0                    cvtsi2sd    xmm0, eax
    48                                  
    49 00000048 C9                      leave
    50 00000049 C3                      ret
    51                                  
    52                                  
    53                                  global SquareTETRAHEDRON
    54                                  SquareTETRAHEDRON:
    55                                  section .data
    56 00000008 2F705AE87AB6FB3F            sqrt_3 dq 1.7320508076
    57                                  
    58                                  section .text
    59 0000004A 55                      push rbp
    60 0000004B 4889E5                  mov rbp, rsp
    61                                  
    62                                      ; В rdi адрес прямоугольника
    63 0000004E 8B07                        mov eax, [rdi]
    64 00000050 F20F2AC0                    cvtsi2sd    xmm0, eax
    65 00000054 F20F100C25-                 movsd xmm1, [sqrt_3]
    65 00000059 [08000000]         
    66 0000005D F20F59C0                    mulsd xmm0, xmm0
    67 00000061 F20F59C1                    mulsd xmm0, xmm1
    68                                  
    69 00000065 C9                      leave
    70 00000066 C3                      ret
    71                                  
    72                                  
    73                                  global PerimeterShape
    74                                  PerimeterShape:
    75                                  section .text
    76 00000067 55                      push rbp
    77 00000068 4889E5                  mov rbp, rsp
    78                                  
    79                                      ; В rdi адрес фигуры
    80 0000006B 8B07                        mov eax, [rdi]
    81 0000006D 3B0425[00000000]            cmp eax, [SPHERE]
    82 00000074 741A                        je sphereSquare
    83 00000076 3B0425[00000000]            cmp eax, [PARALLELEPIPED]
    84 0000007D 741C                        je parallelSquare
    85 0000007F 3B0425[00000000]            cmp eax, [TETRAHEDRON]
    86 00000086 741E                        je tetrahSquare
    87 00000088 31C0                        xor eax, eax
    88 0000008A F20F2AC0                    cvtsi2sd    xmm0, eax
    89 0000008E EB1F                        jmp     return
    90                                  sphereSquare:
    91                                      ; Вычисление периметра прямоугольника
    92 00000090 4883C704                    add     rdi, 4
    93 00000094 E867FFFFFF                  call    SquareSPHERE
    94 00000099 EB14                        jmp     return
    95                                  parallelSquare:
    96                                      ; Вычисление периметра треугольника
    97 0000009B 4883C704                    add     rdi, 4
    98 0000009F E87DFFFFFF                  call    SquarePARALLELEPIPED
    99 000000A4 EB09                        jmp     return
   100                                  
   101                                  tetrahSquare:
   102 000000A6 4883C704                    add     rdi, 4
   103 000000AA E89BFFFFFF                  call    SquareTETRAHEDRON
   104                                  
   105                                  return:
   106 000000AF C9                      leave
   107 000000B0 C3                      ret
   108                                  
   109                                  ;----------------------------------------------
   110                                  ;// Вычисление суммы периметров всех фигур в контейнере
   111                                  ;double PerimeterSumContainer(void *c, int len) {
   112                                  ;    double sum = 0.0;
   113                                  ;    void *tmp = c;
   114                                  ;    for(int i = 0; i < len; i++) {
   115                                  ;        sum += PerimeterShape(tmp);
   116                                  ;        tmp = tmp + shapeSize;
   117                                  ;    }
   118                                  ;    return sum;
   119                                  ;}
   120                                  global PerimeterSumContainer
   121                                  PerimeterSumContainer:
   122                                  section .data
   123 00000010 0000000000000000            .sum    dq  0.0
   124                                  section .text
   125 000000B1 55                      push rbp
   126 000000B2 4889E5                  mov rbp, rsp
   127                                  
   128                                      ; В rdi адрес начала контейнера
   129 000000B5 89F3                        mov ebx, esi            ; число фигур
   130 000000B7 31C9                        xor ecx, ecx            ; счетчик фигур
   131 000000B9 F20F100C25-                 movsd xmm1, [.sum]      ; перенос накопителя суммы в регистр 1
   131 000000BE [10000000]         
   132                                  .loop:
   133 000000C2 39D9                        cmp ecx, ebx            ; проверка на окончание цикла
   134 000000C4 7D18                        jge .return             ; Перебрали все фигуры
   135                                  
   136 000000C6 4989FA                      mov r10, rdi            ; сохранение начала фигуры
   137 000000C9 E899FFFFFF                  call PerimeterShape     ; Получение периметра первой фигуры
   138 000000CE F20F58C8                    addsd xmm1, xmm0        ; накопление суммы
   139 000000D2 48FFC1                      inc rcx                 ; индекс следующей фигуры
   140 000000D5 4983C220                    add r10, 32           ; адрес следующей фигуры
   141 000000D9 4C89D7                      mov rdi, r10            ; восстановление для передачи параметра
   142 000000DC EBE4                        jmp .loop
   143                                  .return:
   144 000000DE F20F10C1                    movsd xmm0, xmm1
   145 000000E2 C9                      leave
   146 000000E3 C3                      ret
